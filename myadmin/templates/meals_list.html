{% extends "dashboard.html" %}
{% block content %}
<style>
  /* simple table + filter styles (adapt to your design variables) */
  .page-head { display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap; margin-bottom:12px; min-width: 980px; }
  .filters { display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin-bottom:12px; }
  .filters input, .filters select { padding:8px 10px; border-radius:8px; border:1px solid var(--border); }
  .btn { padding:8px 12px; border-radius:10px; background:var(--accent); color:#fff; text-decoration:none; font-weight:700; }
  .btn.ghost { background:transparent; color:var(--text); border:1px solid var(--border); }
  .card.full { background:white; padding:12px; border-radius:12px; border:1px solid var(--border); }
  table { width:100%; border-collapse:collapse; margin-top:8px; font-size:14px; }
  thead th { text-align:left; padding:10px 12px; color:var(--muted); font-weight:700; border-bottom:1px solid var(--border); }
  tbody td { padding:12px; vertical-align:top; border-bottom:1px solid #f1f3f6; }
  @media (max-width:900px){
    thead { display:none; }
    tbody td { display:block; padding:10px 0; }
    tbody tr { border-bottom:1px dashed var(--border); padding:8px 0; }
  }
  .msg{margin:8px 0;padding:10px 12px;border-radius:8px;border:1px solid transparent}
  .msg-success{color:#14532d;background:#ecfdf5;border-color:#bbf7d0}
  .msg-error{color:#7f1d1d;background:#fff1f2;border-color:#fecaca}
  .pic-preview img { height:80px; border-radius:10px; display:block; margin-bottom:6px; }
</style>

<div class="page-head">
  <div>
    <h1>Meals</h1>
    <p style="color:var(--muted); margin:6px 0 0 0">Create and assign meals to weekdays.</p>
  </div>

  <div>
    <a class="btn" href="{% url 'admin_add_meal' %}">+ Add meal</a>
  </div>
</div>
{% if messages %}
{% for msg in messages %}
    <p class="{% if msg.tags == 'error' %}msg msg-error{% else %}msg msg-success{% endif %}">{{ msg }}</p>
{% endfor %}
{% endif %}

<div class="card full" role="region" aria-label="Meals list">
  <form method="get" class="filters" role="search" aria-label="Filter meals">
    <input type="search" name="name" placeholder="Search by name" value="{{ filter_name }}" aria-label="Meal name">
    <select name="meal_type" aria-label="Meal type">
      <option value="">All meal types</option>
      {% for val,label in MEAL_TYPE %}
        <option value="{{ val }}" {% if filter_meal_type == val %}selected{% endif %}>{{ label }}</option>
      {% endfor %}
    </select>

    <select name="weekday" aria-label="Weekday">
      <option value="">Any weekday</option>
      {% for val,label in WEEKDAYS %}
        <option value="{{ val }}" {% if filter_weekday == val|stringformat:"s" %}selected{% endif %}>{{ label }}</option>
      {% endfor %}
    </select>

    <button type="submit" class="btn">Filter</button>
    <a class="btn ghost" href="{% url 'admin_meals_list' %}">Clear</a>
  </form>

  {% if meals %}
    <table role="table" aria-label="Meals">
      <thead>
        <tr>
          <th scope="col">Photo</th>
          <th scope="col">Name</th>
          <th scope="col">Type</th>
          <th scope="col">Weekday</th>
          <th scope="col">Rate</th>
          <th scope="col">Created</th>
          <th scope="col">Actions</th>
        </tr>
      </thead>

      <tbody>
        {% for meal in meals %}
        <tr>
          <td>
            {% if meal.meal_pic %}
              <img src="{{ meal.meal_pic.url }}" alt="{{ meal.meal_name }}" style="height:48px;border-radius:6px;object-fit:cover;">
            {% else %}
              <div style="height:48px;width:48px;border-radius:6px;background:#f3f4f6;display:inline-block"></div>
            {% endif %}
          </td>

          <td style="font-weight:700;">{{ meal.meal_name }}</td>
          <td>{{ meal.get_meal_type_display }}</td>
          <td>{{ meal.get_weekday_display }}</td>
          <td>â‚¹{{ meal.rate }}</td>
          <td style="white-space:nowrap;">{{ meal.created_at|date:"Y-m-d H:i" }}</td>

          <td>
            <div style="display:flex;gap:8px;align-items:center;">
              <a class="btn ghost" href="{% url 'admin_edit_meal' meal.meal_id %}">Edit</a>

              <form action="{% url 'admin_delete_meal' meal.meal_id %}" method="post" style="display:inline;">
                {% csrf_token %}
                <button type="submit" onclick="return confirm('Delete this meal?');" style="background:transparent;border:none;color:#b91c1c;font-weight:700;cursor:pointer;">
                  Delete
                </button>
              </form>
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <div style="padding:24px;text-align:center">
      <p style="font-weight:700;margin:0">No meals found</p>
      <p style="color:var(--muted);margin:8px 0 16px 0">Try clearing filters or add a new meal.</p>
      <a class="btn" href="{% url 'admin_add_meal' %}">+ Add meal</a>
    </div>
  {% endif %}
</div>
{% endblock %}
