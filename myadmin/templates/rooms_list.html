<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Rooms — Admin</title>
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin />
    <link
      rel="stylesheet"
      as="style"
      onload="this.rel='stylesheet'"
      href="https://fonts.googleapis.com/css2?display=swap&amp;family=Noto+Sans%3Awght%40400%3B500%3B700%3B900&amp;family=Public+Sans%3Awght%40400%3B500%3B700%3B900"
    />
    <style>
      :root{--bg:#f5f6fb;--card:#fff;--muted:#6b7280;--text:#0f172a;--border:#e6e9ef;--accent:#0f172a;--radius:12px;font-family:"Public Sans","Noto Sans",system-ui,Arial}
      *{box-sizing:border-box}
      body{margin:0;background:var(--bg);color:var(--text);font-family:inherit}
      header{background:#fff;border-bottom:1px solid var(--border);padding:12px 20px;display:flex;align-items:center;justify-content:space-between}
      header h1{margin:0;font-size:18px}
      .container{max-width:1200px;margin:20px auto;padding:18px}

      .topbar{display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin-bottom:14px}
      .btn{display:inline-flex;align-items:center;gap:8px;padding:8px 10px;background:var(--accent);color:#fff;border-radius:8px;text-decoration:none;border:0}
      .ghost{background:transparent;color:var(--text);border:1px solid var(--border)}
      .filters{margin-left:auto;display:flex;gap:8px;align-items:center}
      input[type="text"], select{padding:8px;border-radius:8px;border:1px solid var(--border)}

      .table-wrap{background:var(--card);border-radius:12px;overflow:auto;border:1px solid var(--border)}
      table{width:100%;border-collapse:collapse;min-width:1100px}
      thead th{background:#fbfdff;text-align:left;padding:12px;border-bottom:1px solid var(--border);font-weight:700}
      tbody td{padding:12px;border-bottom:1px solid #f1f4f8;vertical-align:top}

      .thumb{width:96px;height:64px;object-fit:cover;border-radius:6px;border:1px solid var(--border)}
      .students-col{max-width:200px}
      .muted{color:var(--muted)}

      .empty{padding:30px;text-align:center;color:var(--muted)}

      /* responsive */
      @media (max-width:1100px){
        table{min-width:900px}
      }
      @media (max-width:760px){
        .container{padding:12px}
        .filters{width:100%;margin-top:8px}
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Rooms</h1>
      <div>
        <a class="btn" href="{% url 'create_room' %}">Create new room</a>
      </div>
    </header>

    <main class="container">
      <div class="topbar">
        <div class="muted">Rooms overview</div>
        <div class="filters">
          <form method="get" style="display:flex;gap:8px;align-items:center">
            <input type="text" name="q" placeholder="search room / block" value="{{ search|default:'' }}">
            <select name="status">
              <option value="">All status</option>
              {% for v,label in status_choices %}
                <option value="{{ v }}" {% if selected_status == v %}selected{% endif %}>{{ label }}</option>
              {% endfor %}
            </select>
            <button class="btn" type="submit">Filter</button>
          </form>
        </div>
      </div>

      <div class="table-wrap">
        <table role="table" aria-label="rooms table">
          <thead>
            <tr>
              <th>Room</th>
              <th>Block</th>
              <th>Type</th>
              <th>Capacity</th>
              <th>Occupied</th>
              <th>Occupancy%</th>
              <th>Rent</th>
              <th>Status</th>
              <th>Image</th>
              <th>Created At</th>
              <th>Students</th>
            </tr>
          </thead>
          <tbody>
            {% for info in rooms_info %}
              <tr>
                <td><a href="{% url 'room_detail' info.room.room_id %}">{{ info.room.room_number }}</a></td>
                <td>{{ info.room.block_number }}</td>
                <td>{{ info.room.type }}</td>
                <td>{{ info.room.capacity }}</td>
                <td>{{ info.room.occupied }}</td>
                <td>{{ info.occupancy_pct }}%</td>
                <td>₹{{ info.room.room_rent }}</td>
                <td>{{ info.room.status }}</td>
                <td>
                  {% if info.room.image %}
                    <a href="{{ info.room.image.url }}" target="_blank"><img class="thumb" src="{{ info.room.image.url }}" alt="Room {{ info.room.room_number }}"></a>
                  {% else %}
                    <span class="muted">No image</span>
                  {% endif %}
                </td>
                <td>{{ info.room.created_at|date:"Y-m-d H:i" }}</td>
                <td class="students-col">
                  {% for s in info.students %}
                    <div><a href="{% url 'student_detail' s.student_id %}">{{ s.name }}</a> <span class="muted">({{ s.student_id }})</span></div>
                  {% empty %}
                    -
                  {% endfor %}
                </td>
              </tr>
            {% empty %}
              <tr><td colspan="11" class="empty">No rooms</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      {% if page_obj %}
        <div style="display:flex;justify-content:center;margin-top:12px;gap:8px;align-items:center">
          {% if page_obj.has_previous %}<a class="btn ghost" href="?page={{ page_obj.previous_page_number }}">Prev</a>{% endif %}
          <span class="muted">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
          {% if page_obj.has_next %}<a class="btn ghost" href="?page={{ page_obj.next_page_number }}">Next</a>{% endif %}
        </div>
      {% endif %}

    </main>
  </body>
</html>
