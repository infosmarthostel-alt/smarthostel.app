{% extends "home.html" %}
{% block content %}

{% load static %}
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Edit Profile</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="icon" type="image/png" href="/static/favicon.png">
  <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
  <link rel="stylesheet" as="style" onload="this.rel='stylesheet'"
        href="https://fonts.googleapis.com/css2?display=swap&amp;family=Noto+Sans%3Awght%40400%3B500%3B700%3B900&amp;family=Public+Sans%3Awght%40400%3B500%3B700%3B900">

  <style>
    :root{
      --bg:#fff; --muted:#617589; --text:#111418; --border:#dbe0e6; --surface:#f0f2f4;
      --accent:#111418; --radius:12px; --pad-x:40px; --max-w:960px;
      font-family:"Public Sans","Noto Sans",system-ui,-apple-system,"Segoe UI",Roboto,Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased}
    a{color:inherit;text-decoration:none}
    img{max-width:100%;height:auto;display:block}

    /* header */
    .site-header{display:flex;align-items:center;justify-content:space-between;padding:12px var(--pad-x);border-bottom:1px solid var(--border)}
    .brand{display:flex;align-items:center;gap:12px}
    .brand h1{font-size:18px;margin:0;font-weight:700}
    .header-right{display:flex;align-items:center;gap:16px}
    .btn-ghost{background:var(--surface);padding:8px 14px;border-radius:10px;font-weight:700}

    /* page */
    .page-wrap{padding:20px var(--pad-x);display:flex;justify-content:center}
    .container{max-width:var(--max-w);width:100%}
    .page-title{margin-bottom:16px}
    .page-title h2{font-size:26px;margin:0;font-weight:700}

    /* messages */
    .msg{margin:8px 0;padding:10px 12px;border-radius:8px;border:1px solid transparent}
    .msg-success{color:#14532d;background:#ecfdf5;border-color:#bbf7d0}
    .msg-error{color:#7f1d1d;background:#fff1f2;border-color:#fecaca}

    /* form card */
    .card{background:#fff;border:1px solid var(--border);border-radius:12px;padding:18px}
    .form-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .full{grid-column:1/-1}

    label{display:block;margin:8px 0 6px 0;color:var(--muted);font-weight:600}
    input[type="text"], input[type="email"], input[type="number"], input[type="date"], select, input[type="file"], input[type="password"]{
      width:100%;padding:10px 12px;border-radius:10px;border:1px solid var(--border);outline:none;font-size:14px;
    }
    input:focus, select:focus{box-shadow:0 0 0 3px rgba(17,20,24,0.04);border-color:var(--accent)}

    .note{font-size:11px;color:var(--muted);margin-top:8px}

    .row {display:flex;gap:12px;align-items:center}
    .preview{width:120px;height:120px;border-radius:10px;border:1px solid var(--border);background-position:center;background-size:cover;flex-shrink:0;display:flex;align-items:center;justify-content:center;color:var(--muted)}

    .errorsmall{color:#b91c1c;font-size:13px;margin-top:6px}

    .actions{display:flex;gap:12px;align-items:center;margin-top:14px}
    .btn-primary{background:var(--accent);color:#fff;padding:10px 16px;border-radius:10px;border:none;font-weight:700;cursor:pointer}
    .btn-secondary{background:transparent;border:1px solid var(--border);padding:9px 14px;border-radius:10px}

    @media (max-width:780px){
      .form-grid{grid-template-columns:1fr}
      .page-wrap{padding:12px}
    }
    * {
      -webkit-tap-highlight-color: transparent !important;
    }

  </style>
</head>
<body>


  <div class="page-wrap">
    <main class="container">
      <div class="page-title"><h2>Edit Profile</h2></div>

      {% if messages %}
        {% for msg in messages %}
          <p class="{% if msg.tags == 'error' %}msg msg-error{% else %}msg msg-success{% endif %}">{{ msg }}</p>
        {% endfor %}
      {% endif %}

      <form method="post" enctype="multipart/form-data" class="card" novalidate>
        {% csrf_token %}
        <div class="form-grid">
          <div>
            <label for="id_name">Name *</label>
            <input id="id_name" type="text" name="name" value="{{ student.name|default_if_none:'' }}">
            {% if errors.name %}<div class="errorsmall">{{ errors.name }}</div>{% endif %}
          </div>

          <div>
            <label for="id_age">Age</label>
            <input id="id_age" type="number" name="age" value="{{ student.age|default_if_none:'' }}">
            {% if errors.age %}<div class="errorsmall">{{ errors.age }}</div>{% endif %}
          </div>

          <div>
            <label for="id_gender">Gender</label>
            <select id="id_gender" name="gender">
              <option value="">-- select --</option>
              {% for val,label in gender_choices %}
                <option value="{{ val }}" {% if student.gender == val %}selected{% endif %}>{{ label }}</option>
              {% endfor %}
            </select>
          </div>

          <div>
            <label for="id_phone">Phone</label>
            <input id="id_phone" type="text" name="phone" value="{{ student.phone|default_if_none:'' }}">
          </div>

          <div class="full">
            <label for="id_email">Email</label>
            <input id="id_email" type="email" name="email" value="{{ student.email|default_if_none:'' }}">
            {% if errors.email %}<div class="errorsmall">{{ errors.email }}</div>{% endif %}
          </div>

          <div class="full"><hr></div>

          <div class="full"><h3 style="margin:0 0 6px 0">Parent / Guardian</h3></div>

          <div>
            <label for="id_parent_name">Parent Name</label>
            <input id="id_parent_name" type="text" name="parent_name" value="{{ student.parent_name|default_if_none:'' }}">
          </div>

          <div>
            <label for="id_parent_phone">Parent Phone</label>
            <input id="id_parent_phone" type="text" name="parent_phone" value="{{ student.parent_phone|default_if_none:'' }}">
          </div>

          <div class="full">
            <label for="id_parent_email">Parent Email</label>
            <input id="id_parent_email" type="email" name="parent_email" value="{{ student.parent_email|default_if_none:'' }}">
          </div>

          <div class="full"><hr></div>

          <div>
            <label for="id_district">District</label>
            <select id="id_district" name="district">
              <option value="">-- select --</option>
              {% for val,label in district_choices %}
                <option value="{{ val }}" {% if student.district == val %}selected{% endif %}>{{ label }}</option>
              {% endfor %}
            </select>
          </div>

          <div>
            <label for="id_pincode">Pincode</label>
            <input id="id_pincode" type="text" name="pincode" value="{{ student.pincode|default_if_none:'' }}">
          </div>

          <div>
            <label for="id_joined">Joined Date</label>
            <input id="id_joined" type="date" name="joined_date" value="{{ student.joined_date|default_if_none:'' }}">
          </div>

          <div class="full">
            <label>Profile picture</label>
            <div class="row" style="align-items:flex-start;">
              {% if student.profile_pic %}
                <div id="currentPreview" class="preview" style="background-image:url('{{ student.profile_pic.url }}');"></div>
              {% else %}
                <div id="currentPreview" class="preview" style="background:#f8fafc;color:var(--muted)">No image</div>
              {% endif %}
              <div style="flex:1;">
                <input type="file" id="id_profile_pic" name="profile_pic" accept="image/*">
                <div class="note">Accepted types: jpg, png. Max size enforced server-side.</div>
              </div>
            </div>
          </div>

          <div class="full">
            <p class="note">Note: ID proof and room assignment cannot be changed here.</p>
          </div>
        </div>

        <div class="actions">
          <button class="btn-primary" type="submit">Save changes</button>
          <a class="btn-secondary" href="{% url 'profile_view' %}">Cancel</a>
        </div>
      </form>
    </main>
  </div>

  <script>
    // Preview profile image on file select
    (function(){
      const file = document.getElementById('id_profile_pic');
      const preview = document.getElementById('currentPreview');
      if(!file || !preview) return;
      file.addEventListener('change', (e)=>{
        const f = e.target.files && e.target.files[0];
        if(!f) return;
        const reader = new FileReader();
        reader.onload = ()=> preview.style.backgroundImage = `url('${reader.result}')`;
        reader.readAsDataURL(f);
      });
    })();
  </script>
</body>
</html>
{% endblock %}