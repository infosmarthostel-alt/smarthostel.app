<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Student Registration</title>
  <link rel="icon" type="image/png" href="/static/favicon.png">
  <style>
    :root {
      --bg: #ffffff;
      --muted: #617589;
      --text: #111418;
      --border: #dbe0e6;
      --surface: #f0f2f4;
      --accent: #111418;
      --radius: 12px;
      --gap: 16px;
      --max-width: 960px;
      --container-padding-x: 20px;
      font-family: "Public Sans", "Noto Sans", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }

    *, *::before, *::after { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; padding: 0; background: var(--bg); color: var(--text); }
    a { text-decoration: none; color: inherit; }

    .layout-container { display: flex; flex-direction: column; min-height: 100vh; }
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px var(--container-padding-x);
      border-bottom: 1px solid var(--border);
      flex-wrap: wrap;
      gap: 12px;
    }
    fieldset{
      border: none;
    }
    header .brand { display: flex; align-items: center; gap: 10px; flex-shrink: 1; }
    header .brand svg { width: 32px; height: 32px; }
    header h2 { font-size: 18px; margin: 0; font-weight: 700; letter-spacing: -0.3px; }

    header .right {       
      padding: 6px 16px;
      border: none;
      border-radius: 10px;
      background: var(--accent);
      color: white;
      font-weight: 500;
      font-size: 16px;
      cursor: pointer; }

    .page-wrap {
      flex: 1;
      padding: 20px var(--container-padding-x);
      display: flex;
      justify-content: center;
    }
    .layout-content-container { max-width: var(--max-width); width: 100%; }

    .form-card {
      background: #fff;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 24px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.05);
    }
    *{
      -webkit-tap-highlight-color: transparent !important;
    }



    .form-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 14px 20px;
      align-items: start;
    }

    label {
      display: block;
      font-size: 14px;
      font-weight: 500;
      margin-bottom: 6px;
      color: var(--text);
    }

    input[type="text"],
    input[type="number"],
    input[type="email"],
    input[type="date"],
    input[type="password"],
    select,
    input[type="file"] {
      width: 100%;
      padding: 11px 12px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 16px;
      background: #fff;
    }

    select { height: 48px; }

    legend {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 16px;
      padding: 0;
    }

    hr {
      margin: 28px 0;
      border: none;
      border-top: 1px solid var(--border);
    }


    .room-list {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    .room-card {
      padding: 16px;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      background: #fff;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .room-card label {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      cursor: pointer;
      margin: 0;
    }
    .room-card input[type="radio"] {
      margin-top: 4px;
      flex-shrink: 0;
    }
    .room-meta {
      font-size: 13px;
      color: var(--muted);
      margin-top: 4px;
    }
    .room-thumb img {
      width: 100%;
      height: 140px;
      object-fit: cover;
      border-radius: 8px;
      margin-top: 8px;
    }

    .actions {
      display: flex;
      justify-content: flex-end;
      gap: 12px;
      margin-top: 32px;
      flex-wrap: wrap;
    }
    button[type="submit"] {
      padding: 13px 28px;
      border: none;
      border-radius: 10px;
      background: var(--accent);
      color: white;
      font-weight: 700;
      font-size: 16px;
      min-height: 50px;
      cursor: pointer;
    }

    @media (min-width: 640px) {
      :root { --container-padding-x: 40px; }
      .form-grid { grid-template-columns: 220px 1fr; }
      .room-card { flex-direction: row; align-items: center; }
      .room-thumb img { width: 160px; height: 120px; margin-top: 0; }
    }

    @media (max-width: 480px) {
      header { padding: 12px 16px; }
      header .right { justify-content: space-between; }
      .form-card { padding: 10px; border: none; }
      button[type="submit"] { width: 100%; }
      .page-wrap{ border: none; padding: 0;}
    }
    ul { padding-left: 20px; margin: 12px 0; }
    ul li { color: #d32f2f; }
  </style>
</head>
<body class="layout-container">

  <header>
    <div class="brand">
      <div class="size-4" aria-hidden="true">
        <svg viewBox="0 -6.83 55.484 55.484" xmlns="http://www.w3.org/2000/svg">
          <g transform="translate(-819.325 -209.09)">
            <path d="M830.341,217.538a19.3,19.3,0,0,0-4.606,12.57,19.006,19.006,0,0,0,14.6,18.648" fill="none" stroke="#231f20" stroke-linecap="round" stroke-linejoin="round" stroke-width="3"/>
            <path d="M833.052,246.26a5.987,5.987,0,0,1,3.847,1.94.246.246,0,0,1,0,.335,4.866,4.866,0,0,1-7.725-.067.247.247,0,0,1,0-.336A5.979,5.979,0,0,1,833.052,246.26Z" fill="none" stroke="#231f20" stroke-linecap="round" stroke-linejoin="round" stroke-width="3"/>
            <path d="M826.455,239.3a6.123,6.123,0,0,1,2.948,3.19.244.244,0,0,1-.116.314,5.9,5.9,0,0,1-4.272.373,6.127,6.127,0,0,1-2.948-3.19.245.245,0,0,1,.117-.314A5.9,5.9,0,0,1,826.455,239.3Z" fill="none" stroke="#231f20" stroke-linecap="round" stroke-linejoin="round" stroke-width="3"/>
            <path d="M824.232,230.16a6.239,6.239,0,0,1,1.955,3.909.241.241,0,0,1-.2.268,5.905,5.905,0,0,1-4.2-.871,6.242,6.242,0,0,1-1.955-3.91.242.242,0,0,1,.2-.268A5.907,5.907,0,0,1,824.232,230.16Z" fill="none" stroke="#231f20" stroke-linecap="round" stroke-linejoin="round" stroke-width="3"/>
            <path d="M826.109,220.822a6.322,6.322,0,0,1,.1,4.392.236.236,0,0,1-.292.153,6.046,6.046,0,0,1-3.416-2.655,6.322,6.322,0,0,1-.1-4.392.236.236,0,0,1,.292-.153A6.046,6.046,0,0,1,826.109,220.822Z" fill="none" stroke="#231f20" stroke-linecap="round" stroke-linejoin="round" stroke-width="3"/>
            <path d="M833.948,214.106a6.091,6.091,0,0,1-3.1,3.037.234.234,0,0,1-.307-.118,6.317,6.317,0,0,1-.386-4.375,6.085,6.085,0,0,1,3.1-3.037.233.233,0,0,1,.307.118A6.31,6.31,0,0,1,833.948,214.106Z" fill="none" stroke="#231f20" stroke-linecap="round" stroke-linejoin="round" stroke-width="3"/>
            <path d="M863.793,217.538a19.3,19.3,0,0,1,4.606,12.57,19.006,19.006,0,0,1-14.6,18.648" fill="none" stroke="#231f20" stroke-linecap="round" stroke-linejoin="round" stroke-width="3"/>
            <path d="M861.082,246.26a5.987,5.987,0,0,0-3.847,1.94.246.246,0,0,0,0,.335,4.866,4.866,0,0,0,7.725-.067.246.246,0,0,0,0-.336A5.974,5.974,0,0,0,861.082,246.26Z" fill="none" stroke="#231f20" stroke-linecap="round" stroke-linejoin="round" stroke-width="3"/>
            <path d="M867.678,239.3a6.125,6.125,0,0,0-2.947,3.19.244.244,0,0,0,.116.314,5.9,5.9,0,0,0,4.272.373,6.127,6.127,0,0,0,2.948-3.19.245.245,0,0,0-.117-.314A5.9,5.9,0,0,0,867.678,239.3Z" fill="none" stroke="#231f20" stroke-linecap="round" stroke-linejoin="round" stroke-width="3"/>
            <path d="M869.9,230.16a6.239,6.239,0,0,0-1.955,3.909.241.241,0,0,0,.2.268,5.9,5.9,0,0,0,4.2-.871,6.241,6.241,0,0,0,1.955-3.91.242.242,0,0,0-.2-.268A5.907,5.907,0,0,0,869.9,230.16Z" fill="none" stroke="#231f20" stroke-linecap="round" stroke-linejoin="round" stroke-width="3"/>
            <path d="M868.025,220.822a6.322,6.322,0,0,0-.1,4.392.236.236,0,0,0,.292.153,6.046,6.046,0,0,0,3.416-2.655,6.322,6.322,0,0,0,.1-4.392.236.236,0,0,0-.292-.153A6.042,6.042,0,0,0,868.025,220.822Z" fill="none" stroke="#231f20" stroke-linecap="round" stroke-linejoin="round" stroke-width="3"/>
            <path d="M860.186,214.106a6.091,6.091,0,0,0,3.1,3.037.234.234,0,0,0,.307-.118,6.317,6.317,0,0,0,.386-4.375,6.086,6.086,0,0,0-3.1-3.037.233.233,0,0,0-.307.118A6.311,6.311,0,0,0,860.186,214.106Z" fill="none" stroke="#231f20" stroke-linecap="round" stroke-linejoin="round" stroke-width="3"/>
            <path d="M847.238,218.546l-9.83,10.137c-.1.1.069.236.069.378v10.352c0,.3-.208.947.088.947h19.56c.3,0,.352-.651.352-.947V229.061c0-.142.036-.277-.064-.378l-10.007-10.137C847.2,218.335,847.447,218.335,847.238,218.546Z" fill="none" stroke="#231f20" stroke-linecap="round" stroke-linejoin="round" stroke-width="3"/>
            <rect width="6" height="7" rx="0.547" transform="translate(844.477 232.36)" stroke-width="3" stroke="#231f20" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
            <line y1="12.336" x2="12.564" transform="translate(834.674 218.546)" stroke-width="3" stroke="#231f20" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
            <line x1="12.564" y1="12.336" transform="translate(847.301 218.546)" stroke-width="3" stroke="#231f20" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
          </g>
        </svg>
      </div>
      <h2>Register</h2>
    </div>

    <div class="right">
      <nav class="links">
        <a href="/">Back</a>
      </nav>
    </div>
  </header>

  <div class="page-wrap">
    <main class="layout-content-container">
      <div class="form-card">

        {% if messages %}
          <ul>
            {% for msg in messages %}
              <li>{{ msg }}</li>
            {% endfor %}
          </ul>
        {% endif %}

        <form method="post" action="{% url 'student_register' %}" enctype="multipart/form-data">
          {% csrf_token %}

          <fieldset>
            <legend>Student info</legend>
            <div class="form-grid">
              <div><label>Name</label></div>
              <div><input type="text" name="name" value="{{ post.name|default:'' }}" required></div>

              <div><label>Age</label></div>
              <div><input type="number" name="age" value="{{ post.age|default:'' }}" min="1"></div>

              <div><label>Gender</label></div>
              <div>
                <select name="gender">
                  <option value="">--</option>
                  <option value="Male>Male</option>
                  <option value="Female">Female</option>
                  <option value="Other">Other</option>
                </select>
              </div>

              <div><label>Phone</label></div>
              <div><input type="text" name="phone" value="{{ post.phone|default:'' }}"></div>

              <div><label>Email</label></div>
              <div><input type="email" name="email" value="{{ post.email|default:'' }}"></div>

              <div><label>Password</label></div>
              <div><input type="password" name="password" required></div>

              <div><label>Joined date</label></div>
              <div><input type="date" name="joined_date" value="{{ post.joined_date|default:'' }}"></div>

              <div><label>Profile photo</label></div>
              <div><input type="file" name="profile"></div>

              <div><label>ID proof</label></div>
              <div><input type="file" name="id_proof"></div>

              <div><label>Programme</label></div>
              <div>
                <select name="programme" id="programme-select" required>
                  <option value="">-- Select programme --</option>
                  <option value="BCA">BCA - Bachelor of Computer Applications</option>
                  <option value="BSC_CS">B.Sc Computer Science</option>
                  <option value="BSC_IT">B.Sc Information Technology</option>
                  <option value="BTECH_CS">B.Tech Computer Science & Engineering</option>
                  <option value="BTECH_IT">B.Tech Information Technology</option>
                  <option value="BTECH_EC">B.Tech Electronics & Communication</option>
                  <option value="BTECH_EE">B.Tech Electrical Engineering</option>
                  <option value="BTECH_ME">B.Tech Mechanical Engineering</option>
                  <option value="BTECH_CE">B.Tech Civil Engineering</option>
                  <option value="BTECH_AE">B.Tech Aeronautical Engineering</option>
                  <option value="MCA">MCA - Master of Computer Applications</option>
                  <option value="MSC_CS">M.Sc Computer Science</option>
                  <option value="MTECH_CS">M.Tech Computer Science & Engineering</option>
                  <option value="MTECH_IT">M.Tech Information Technology</option>
                  <option value="MTECH_EC">M.Tech Electronics & Communication</option>
                  <option value="MTECH_ME">M.Tech Mechanical Engineering</option>
                  <option value="MTECH_CE">M.Tech Civil Engineering</option>
                  <option value="MBA">MBA - Master of Business Administration</option>
                  <option value="DIP_CS">Diploma in Computer Science</option>
                  <option value="DIP_CE">Diploma in Civil Engineering</option>
                  <option value="DIP_ME">Diploma in Mechanical Engineering</option>
                  <option value="DIP_EE">Diploma in Electrical Engineering</option>
                </select>
              </div>
            </div>
          </fieldset>

          <hr>

          <fieldset>
            <legend>Parent / Emergency Contact</legend>
            <div class="form-grid">
              <div><label>Parent name</label></div>
              <div><input type="text" name="parent_name" value="{{ post.parent_name|default:'' }}"></div>

              <div><label>Parent phone</label></div>
              <div><input type="text" name="parent_phone" value="{{ post.parent_phone|default:'' }}"></div>

              <div><label>Parent email</label></div>
              <div><input type="email" name="parent_email" value="{{ post.parent_email|default:'' }}"></div>
            </div>
          </fieldset>

          <hr>

          <fieldset>
            <legend>Address</legend>
            <div class="form-grid">
              <div><label>District</label></div>
              <div>
                <select name="district">
                  <option value="">--</option>
                  <option>Kasaragod</option><option>Kannur</option><option>Wayanad</option>
                  <option>Kozhikode</option><option>Malappuram</option><option>Palakkad</option>
                  <option>Thrissur</option><option>Ernakulam</option><option>Idukki</option>
                  <option>Kottayam</option><option>Alappuzha</option><option>Pathanamthitta</option>
                  <option>Kollam</option><option>Thiruvananthapuram</option>
                </select>
              </div>

              <div><label>Pincode</label></div>
              <div><input type="text" name="pincode" value="{{ post.pincode|default:'' }}"></div>
            </div>
          </fieldset>

          <hr>

          <fieldset>
            <legend>Choose preferred room (optional)</legend>

            <div class="room-list">
              {% for r in rooms %}
              <div class="room-card">
                <label class="form-row">
                  <input type="radio" name="preferred_room" value="{{ r.instance.pk }}">
                  <div style="flex:1">
                    <div><strong>Room: {{ r.instance.room_number }}</strong></div>
                    <div class="room-meta">
                      Type: {{ r.instance.type }} |
                      Capacity: {{ r.instance.capacity }} |
                      Occupied: {{ r.instance.occupied }} |
                      Available: <strong>{{ r.available }}</strong> |
                      Same programme in room: <strong class="same-count" data-room-id="{{ r.instance.pk }}">0</strong>
                    </div>
                  </div>
                </label>

                {% if r.instance.image %}
                  <div class="room-thumb"><img src="{{ r.instance.image.url }}" alt="Room image"></div>
                {% endif %}
              </div>
              {% endfor %}
            </div>

            <p><small>If you don't want to select a room now, leave this blank.</small></p>
          </fieldset>

          <div class="actions">
            <button type="submit">Register</button>
          </div>
        </form>
      </div>
    </main>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const select = document.querySelector('select[name="programme"]');
      const apiUrl = "{% url 'room_programme_counts' %}";

      function updateCountsForProgramme(programme) {
        const params = new URLSearchParams({ programme: programme || '' });
        fetch(apiUrl + '?' + params.toString())
          .then(resp => {
            if (!resp.ok) throw new Error('Network error');
            return resp.json();
          })
          .then(data => {
            const counts = data.counts || {};
            document.querySelectorAll('.same-count').forEach(el => {
              const rid = el.dataset.roomId;
              el.textContent = counts[rid] !== undefined ? counts[rid] : '0';
            });
          })
          .catch(err => console.error('Failed to fetch counts:', err));
      }

      if (select) {
        select.addEventListener('change', () => updateCountsForProgramme(select.value));
        if (select.value) updateCountsForProgramme(select.value);
      }
    });
  </script>
</body>
</html>