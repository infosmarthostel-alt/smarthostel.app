<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Student Registration</title>
  <link rel="icon" type="image/png" href="/static/favicon.png">
  <style>
    /* -----------------------------
       Theme variables (colors, sizes)
       ------------------------------*/
    :root{
      --bg: #ffffff;
      --muted: #617589;
      --text: #111418;
      --border: #dbe0e6;
      --surface: #f0f2f4;
      --accent: #111418;
      --radius-xl: 16px;
      --gap: 16px;
      --max-width: 960px;
      --container-padding-x: 40px; /* matches your px-40 */
      font-family: "Public Sans", "Noto Sans", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    /* Reset & layout helpers (keeps layout identical to Tailwind markup) */
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--text)}
    a{text-decoration:none;color:inherit}

    .size-full{width:100%;}
    .min-h-screen{min-height:100vh}

    .layout-container{display:flex;flex-direction:column;min-height:100vh}
    header{display:flex;align-items:center;justify-content:space-between;padding:12px 40px;border-bottom:1px solid var(--border);}

    /* header left */
    header .brand{display:flex;align-items:center;gap:7px}
    header .brand svg{width:30px;height:30px}
    header h2{font-size:18px;margin:0;font-weight:700;letter-spacing:-0.3px}

    /* header right */
    header .right{display:flex;align-items:center;gap:24px}
    header .right .links{display:flex;gap:20px;align-items:center}
    header .right .links a{font-size:14px;font-weight:500;color:var(--text)}

    /* logout button */
    .btn-logout{display:inline-flex;align-items:center;justify-content:center;min-width:84px;height:40px;padding:0 16px;border-radius:12px;background:var(--surface);font-weight:700}

    /* avatar */
    .avatar{width:40px;height:40px;border-radius:999px;background-size:cover;background-position:center;flex-shrink:0}

    /* content area */
    .page-wrap{padding:20px var(--container-padding-x);display:flex;justify-content:center}
    .layout-content-container{max-width:var(--max-width);width:100%;}

    h3{margin:20px 0 8px 0;font-size:16px;font-weight:700}

    /* hostel info grid */
    .hostel-grid{padding:8px;display:inline;}
    .info-row{display:grid;grid-template-columns:200px 1fr;padding:18px 0;border-top:1px solid var(--border);align-items:center}
    .info-label{color:var(--muted);font-size:14px}
    .info-value{font-size:14px}

    /* announcement card */
    .announcement{display:flex;gap:16px;align-items:stretch}
    .announcement .card-text{flex:2}
    .announcement .card-media{flex:1;border-radius:12px;background-size:cover;background-position:center;height:120px}

    /* academic card */
    .cards{display:flex;gap:16px}
    .card{flex:1;min-width:158px;border-radius:12px;padding:18px;border:1px solid var(--border)}
    .card p:first-child{margin:0;font-weight:500}
    .card p:last-child{margin:8px 0 0 0;font-size:22px;font-weight:700}

    /* Quick access tabs */
    .quick-access{border-bottom:1px solid var(--border);padding:0 16px}
    .tabs{display:flex;gap:40px}
    .tab-btn{display:flex;flex-direction:column;align-items:center;gap:6px;padding:10px 0;border-bottom:3px solid transparent;cursor:pointer}
    .tab-btn svg{width:24px;height:24px}
    .tab-btn .label{font-size:14px;font-weight:700;color:var(--muted)}
    .tab-btn.active{border-bottom-color:var(--accent)}
    .tab-btn.active .label{color:var(--accent)}

    /* Tab panels */
    .tab-panels{padding:18px}
    .tab-panel{display:none}
    .tab-panel.active{display:block}

    /* responsive */
    @media (max-width:900px){
      .hostel-grid{grid-template-columns:1fr}
      .info-row{grid-template-columns:1fr}
      header{padding:12px 20px}
      .page-wrap{padding:12px}
    }

    .size-4 {display: flex;}

    /* ---- page specific ---- */
    .page-title{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .form-card{border-radius:12px;border:1px solid var(--border);padding:18px;margin-top:18px;background:#fff}
    fieldset{border:0;padding:0;margin:0}
    legend{font-weight:700;margin-bottom:12px}
    .form-grid{display:grid;grid-template-columns:220px 1fr;gap:12px 24px;padding:8px 0;align-items:center}
    .form-row{display:flex;gap:12px;align-items:center}
    label{display:block;font-size:14px}

    input[type="text"], input[type="number"], input[type="email"], input[type="date"], input[type="password"], select, input[type="file"]{
      width:100%;padding:8px;border:1px solid var(--border);border-radius:8px;background:transparent;font-size:14px
    }

    .room-list{display:flex;flex-direction:column;gap:12px}
    .room-card{padding:12px;border-radius:10px;border:1px solid var(--border);display:flex;gap:12px;align-items:center}
    .room-meta{font-size:13px;color:var(--muted)}
    .room-thumb img{width:120px;border-radius:8px;object-fit:cover}

    .actions{display:flex;justify-content:flex-end;gap:12px;margin-top:18px}
    button[type="submit"]{padding:10px 16px;border-radius:10px;border:0;background:var(--accent);color:white;font-weight:700}

    /* table small adjustments (kept from original) */
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ddd; padding: 8px; }
    th { background: #f0f0f0; }

  </style>
</head>
<body class="layout-container">

  <header>
    <div class="brand">
      <div class="size-4" aria-hidden="true">
        <svg viewBox="0 -6.83 55.484 55.484" xmlns="http://www.w3.org/2000/svg">

          <g transform="translate(-819.325 -209.09)">
          
          <path d="M830.341,217.538a19.3,19.3,0,0,0-4.606,12.57,19.006,19.006,0,0,0,14.6,18.648" fill="none" stroke="#231f20" stroke-linecap="round" stroke-linejoin="round" stroke-width="3"/>
          
          <path d="M833.052,246.26a5.987,5.987,0,0,1,3.847,1.94.246.246,0,0,1,0,.335,4.866,4.866,0,0,1-7.725-.067.247.247,0,0,1,0-.336A5.979,5.979,0,0,1,833.052,246.26Z" fill="none" stroke="#231f20" stroke-linecap="round" stroke-linejoin="round" stroke-width="3"/>
          
          <path d="M826.455,239.3a6.123,6.123,0,0,1,2.948,3.19.244.244,0,0,1-.116.314,5.9,5.9,0,0,1-4.272.373,6.127,6.127,0,0,1-2.948-3.19.245.245,0,0,1,.117-.314A5.9,5.9,0,0,1,826.455,239.3Z" fill="none" stroke="#231f20" stroke-linecap="round" stroke-linejoin="round" stroke-width="3"/>
          
          <path d="M824.232,230.16a6.239,6.239,0,0,1,1.955,3.909.241.241,0,0,1-.2.268,5.905,5.905,0,0,1-4.2-.871,6.242,6.242,0,0,1-1.955-3.91.242.242,0,0,1,.2-.268A5.907,5.907,0,0,1,824.232,230.16Z" fill="none" stroke="#231f20" stroke-linecap="round" stroke-linejoin="round" stroke-width="3"/>
          
          <path d="M826.109,220.822a6.322,6.322,0,0,1,.1,4.392.236.236,0,0,1-.292.153,6.046,6.046,0,0,1-3.416-2.655,6.322,6.322,0,0,1-.1-4.392.236.236,0,0,1,.292-.153A6.046,6.046,0,0,1,826.109,220.822Z" fill="none" stroke="#231f20" stroke-linecap="round" stroke-linejoin="round" stroke-width="3"/>
          
          <path d="M833.948,214.106a6.091,6.091,0,0,1-3.1,3.037.234.234,0,0,1-.307-.118,6.317,6.317,0,0,1-.386-4.375,6.085,6.085,0,0,1,3.1-3.037.233.233,0,0,1,.307.118A6.31,6.31,0,0,1,833.948,214.106Z" fill="none" stroke="#231f20" stroke-linecap="round" stroke-linejoin="round" stroke-width="3"/>
          
          <path d="M863.793,217.538a19.3,19.3,0,0,1,4.606,12.57,19.006,19.006,0,0,1-14.6,18.648" fill="none" stroke="#231f20" stroke-linecap="round" stroke-linejoin="round" stroke-width="3"/>
          
          <path d="M861.082,246.26a5.987,5.987,0,0,0-3.847,1.94.246.246,0,0,0,0,.335,4.866,4.866,0,0,0,7.725-.067.246.246,0,0,0,0-.336A5.974,5.974,0,0,0,861.082,246.26Z" fill="none" stroke="#231f20" stroke-linecap="round" stroke-linejoin="round" stroke-width="3"/>
          
          <path d="M867.678,239.3a6.125,6.125,0,0,0-2.947,3.19.244.244,0,0,0,.116.314,5.9,5.9,0,0,0,4.272.373,6.127,6.127,0,0,0,2.948-3.19.245.245,0,0,0-.117-.314A5.9,5.9,0,0,0,867.678,239.3Z" fill="none" stroke="#231f20" stroke-linecap="round" stroke-linejoin="round" stroke-width="3"/>
          
          <path d="M869.9,230.16a6.239,6.239,0,0,0-1.955,3.909.241.241,0,0,0,.2.268,5.9,5.9,0,0,0,4.2-.871,6.241,6.241,0,0,0,1.955-3.91.242.242,0,0,0-.2-.268A5.907,5.907,0,0,0,869.9,230.16Z" fill="none" stroke="#231f20" stroke-linecap="round" stroke-linejoin="round" stroke-width="3"/>
          
          <path d="M868.025,220.822a6.322,6.322,0,0,0-.1,4.392.236.236,0,0,0,.292.153,6.046,6.046,0,0,0,3.416-2.655,6.322,6.322,0,0,0,.1-4.392.236.236,0,0,0-.292-.153A6.042,6.042,0,0,0,868.025,220.822Z" fill="none" stroke="#231f20" stroke-linecap="round" stroke-linejoin="round" stroke-width="3"/>
          
          <path d="M860.186,214.106a6.091,6.091,0,0,0,3.1,3.037.234.234,0,0,0,.307-.118,6.317,6.317,0,0,0,.386-4.375,6.086,6.086,0,0,0-3.1-3.037.233.233,0,0,0-.307.118A6.311,6.311,0,0,0,860.186,214.106Z" fill="none" stroke="#231f20" stroke-linecap="round" stroke-linejoin="round" stroke-width="3"/>
          
          <path d="M847.238,218.546l-9.83,10.137c-.1.1.069.236.069.378v10.352c0,.3-.208.947.088.947h19.56c.3,0,.352-.651.352-.947V229.061c0-.142.036-.277-.064-.378l-10.007-10.137C847.2,218.335,847.447,218.335,847.238,218.546Z" fill="none" stroke="#231f20" stroke-linecap="round" stroke-linejoin="round" stroke-width="3"/>
          
          <rect width="6" height="7" rx="0.547" transform="translate(844.477 232.36)" stroke-width="3" stroke="#231f20" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
          
          <line y1="12.336" x2="12.564" transform="translate(834.674 218.546)" stroke-width="3" stroke="#231f20" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
          
          <line x1="12.564" y1="12.336" transform="translate(847.301 218.546)" stroke-width="3" stroke="#231f20" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
          
          </g>
          
          </svg>
      </div>
      <h2>Hostel Hostel - Register</h2>
    </div>

    <div class="right">
      <nav class="links">
        <a href="/">Back</a>
      </nav>
    </div>
  </header>

  <div class="page-wrap">
    <main class="layout-content-container">

     

      <div class="form-card">

        {% if messages %}
          <ul>
            {% for msg in messages %}
              <li>{{ msg }}</li>
            {% endfor %}
          </ul>
        {% endif %}

        <form method="post" action="{% url 'student_register' %}" enctype="multipart/form-data">
          {% csrf_token %}

          <fieldset>
            <legend>Student info</legend>
            <div class="form-grid">
              <div class="info-label">Name</div>
              <div><input type="text" name="name" value="{{ post.name|default:'' }}" required></div>

              <div class="info-label">Age</div>
              <div><input type="number" name="age" value="{{ post.age|default:'' }}" min="1"></div>

              <div class="info-label">Gender</div>
              <div>
                <select name="gender">
                  <option value="">--</option>
                  <option value="Male">Male</option>
                  <option value="Female">Female</option>
                  <option value="Other">Other</option>
                </select>
              </div>

              <div class="info-label">Phone</div>
              <div><input type="text" name="phone" value="{{ post.phone|default:'' }}"></div>

              <div class="info-label">Email</div>
              <div><input type="email" name="email" value="{{ post.email|default:'' }}"></div>

              <div class="info-label">Password</div>
              <div><input type="password" name="password" required value="{{ post.password }}"></div>

              <div class="info-label">Joined date</div>
              <div><input type="date" name="joined_date" value="{{ post.joined_date|default:'' }}"></div>

              <div class="info-label">Profile</div>
              <div><input type="file" name="profile"></div>

              <div class="info-label">ID proof</div>
              <div><input type="file" name="id_proof"></div>
              <div class="info-label">Programme</div>
              <div>
                <select name="programme" id="programme-select" required>
                  <option value="">-- Select programme --</option>
                  <option value="BCA">BCA - Bachelor of Computer Applications</option>
                  <option value="BSC_CS">B.Sc Computer Science</option>
                  <option value="BSC_IT">B.Sc Information Technology</option>
                  <option value="BTECH_CS">B.Tech Computer Science & Engineering</option>
                  <option value="BTECH_IT">B.Tech Information Technology</option>
                  <option value="BTECH_EC">B.Tech Electronics & Communication</option>
                  <option value="BTECH_EE">B.Tech Electrical Engineering</option>
                  <option value="BTECH_ME">B.Tech Mechanical Engineering</option>
                  <option value="BTECH_CE">B.Tech Civil Engineering</option>
                  <option value="BTECH_AE">B.Tech Aeronautical Engineering</option>
                  <option value="MCA">MCA - Master of Computer Applications</option>
                  <option value="MSC_CS">M.Sc Computer Science</option>
                  <option value="MTECH_CS">M.Tech Computer Science & Engineering</option>
                  <option value="MTECH_IT">M.Tech Information Technology</option>
                  <option value="MTECH_EC">M.Tech Electronics & Communication</option>
                  <option value="MTECH_ME">M.Tech Mechanical Engineering</option>
                  <option value="MTECH_CE">M.Tech Civil Engineering</option>
                  <option value="MBA">MBA - Master of Business Administration</option>
                  <option value="DIP_CS">Diploma in Computer Science</option>
                  <option value="DIP_CE">Diploma in Civil Engineering</option>
                  <option value="DIP_ME">Diploma in Mechanical Engineering</option>
                  <option value="DIP_EE">Diploma in Electrical Engineering</option>
                </select>
              </div>
            </div>
          </fieldset>

          <hr style="margin:18px 0;border:none;border-top:1px solid var(--border)">

          <fieldset>
            <legend>Parent / Contact</legend>
            <div class="form-grid">
              <div class="info-label">Parent name</div>
              <div><input type="text" name="parent_name" value="{{ post.parent_name|default:'' }}"></div>

              <div class="info-label">Parent phone</div>
              <div><input type="text" name="parent_phone" value="{{ post.parent_phone|default:'' }}"></div>

              <div class="info-label">Parent email</div>
              <div><input type="email" name="parent_email" value="{{ post.parent_email|default:'' }}"></div>
            </div>
          </fieldset>

          <hr style="margin:18px 0;border:none;border-top:1px solid var(--border)">

          <fieldset>
            <legend>Address</legend>
            <div class="form-grid">
              <div class="info-label">District</div>
              <div>
                <select name="district">
                  <option value="">--</option>
                  <option>Kasaragod</option><option>Kannur</option><option>Wayanad</option>
                  <option>Kozhikode</option><option>Malappuram</option><option>Palakkad</option>
                  <option>Thrissur</option><option>Ernakulam</option><option>Idukki</option>
                  <option>Kottayam</option><option>Alappuzha</option><option>Pathanamthitta</option>
                  <option>Kollam</option><option>Thiruvananthapuram</option>
                </select>
              </div>

              <div class="info-label">Pincode</div>
              <div><input type="text" name="pincode" value="{{ post.pincode|default:'' }}"></div>
            </div>
          </fieldset>

          <hr style="margin:18px 0;border:none;border-top:1px solid var(--border)">

          <fieldset>
            <legend>Choose preferred room (one-time, optional)</legend>

            <div class="room-list">
              {% for r in rooms %}
              <div class="room-card">
                <div style="flex:1">
                  <label class="form-row">
                    <input type="radio" name="preferred_room" value="{{ r.instance.pk }}">
                    <div style="margin-left:8px">
                      <div><strong>Room: {{ r.instance.room_number }}</strong></div>
                      <div class="room-meta">
                        Type: {{ r.instance.type }} |
                        Capacity: {{ r.instance.capacity }} |
                        Occupied: {{ r.instance.occupied }} |
                        Available: <strong>{{ r.available }}</strong> |
                        Same programme in room: <strong class="same-count" data-room-id="{{ r.instance.pk }}">0</strong>
                      </div>
                    </div>
                  </label>
                </div>

                {% if r.instance.image %}
                  <div class="room-thumb"><img src="{{ r.instance.image.url }}" alt="room image"></div>
                {% endif %}
              </div>
              {% endfor %}
            </div>

            <p><small>If you don't want to select a room now, leave this blank.</small></p>
          </fieldset>

          <div class="actions">
            <button type="submit">Register</button>
          </div>

        </form>

      </div>

    </main>
  </div>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const select = document.querySelector('select[name="programme"]');
      const apiUrl = "{% url 'room_programme_counts' %}";
    
      function updateCountsForProgramme(programme) {
        const params = new URLSearchParams({ programme: programme || '' });
        fetch(apiUrl + '?' + params.toString())
          .then(resp => {
            if (!resp.ok) throw new Error('Network response was not ok');
            return resp.json();
          })
          .then(data => {
            const counts = data.counts || {};
            document.querySelectorAll('.same-count').forEach(el => {
              const rid = el.dataset.roomId;
              el.textContent = counts[rid] !== undefined ? counts[rid] : '0';
            });
          })
          .catch(err => {
            // silent fail (doesn't break registration); you can console.log for debugging
            console.error('Failed to fetch room programme counts:', err);
          });
      }
    
      if (select) {
        select.addEventListener('change', function () {
          updateCountsForProgramme(this.value);
        });
    
        // initial load if programme pre-selected (useful when re-rendering the form with post data)
        if (select.value) {
          updateCountsForProgramme(select.value);
        }
      }
    });
    </script>
    
</body>
</html>
